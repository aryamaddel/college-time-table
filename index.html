<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mobile Timetable</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: #f3f4f6;
        color: #111827;
        min-height: 100vh;
        line-height: 1.5;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      body.dark {
        background-color: #111827;
        color: #ffffff;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1.5rem 1rem;
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .clock {
        font-size: 1.25rem;
        font-family: "Courier New", monospace;
        font-weight: 600;
      }

      .theme-toggle {
        padding: 0.5rem;
        border: none;
        border-radius: 0.5rem;
        background-color: #e5e7eb;
        cursor: pointer;
        font-size: 1.2rem;
        transition: background-color 0.3s ease;
      }

      .theme-toggle:hover {
        background-color: #d1d5db;
      }

      body.dark .theme-toggle {
        background-color: #374151;
      }

      body.dark .theme-toggle:hover {
        background-color: #4b5563;
      }

      /* Cards */
      .card {
        background-color: #ffffff;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 1rem;
        margin-bottom: 1.5rem;
        transition: background-color 0.3s ease;
      }

      body.dark .card {
        background-color: #1f2937;
      }

      .card-title {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
      }

      /* Current Lecture */
      .current-lecture {
        color: #6b7280;
      }

      body.dark .current-lecture {
        color: #9ca3af;
      }

      .current-lecture.active {
        border-left: 4px solid #10b981;
        padding-left: 1rem;
      }

      .current-lecture.active .lecture-name {
        font-weight: bold;
        color: #059669;
      }

      body.dark .current-lecture.active .lecture-name {
        color: #34d399;
      }

      .current-lecture.active .lecture-details {
        font-size: 0.875rem;
        color: #6b7280;
      }

      body.dark .current-lecture.active .lecture-details {
        color: #9ca3af;
      }

      .current-lecture.break {
        border-left: 4px solid #f59e0b;
        padding-left: 1rem;
      }

      .current-lecture.break .lecture-name {
        font-weight: bold;
        color: #d97706;
      }

      body.dark .current-lecture.break .lecture-name {
        color: #fbbf24;
      }

      .current-lecture.break .lecture-details {
        font-size: 0.875rem;
        color: #6b7280;
      }

      body.dark .current-lecture.break .lecture-details {
        color: #9ca3af;
      }

      /* Day Selector */
      .day-selector {
        display: flex;
        justify-content: space-between;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }

      .day-button {
        flex: 1;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.5rem;
        background-color: #e5e7eb;
        color: #374151;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .day-button:hover {
        background-color: #d1d5db;
      }

      body.dark .day-button {
        background-color: #374151;
        color: #d1d5db;
      }

      body.dark .day-button:hover {
        background-color: #4b5563;
      }

      .day-button.active {
        background-color: #10b981;
        color: #ffffff;
      }

      .day-button.active:hover {
        background-color: #059669;
      }

      /* Schedule */
      .schedule-item {
        border-left: 4px solid #10b981;
        padding-left: 1rem;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
      }

      .schedule-item:last-child {
        margin-bottom: 0;
      }

      .schedule-item .lecture-name {
        font-weight: bold;
        margin-bottom: 0.25rem;
      }

      .schedule-item .lecture-details {
        font-size: 0.875rem;
        color: #6b7280;
      }

      body.dark .schedule-item .lecture-details {
        color: #9ca3af;
      }

      .no-classes {
        color: #6b7280;
        font-style: italic;
      }

      body.dark .no-classes {
        color: #9ca3af;
      }

      /* Footer */
      .footer {
        text-align: center;
        padding: 1.5rem 0;
        color: #6b7280;
        margin-top: 2rem;
      }

      body.dark .footer {
        color: #9ca3af;
      }

      .footer a {
        color: #10b981;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      body.dark .footer a {
        color: #34d399;
      }

      .footer-actions {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      @media (min-width: 640px) {
        .footer-actions {
          flex-direction: row;
        }
      }

      .github-button {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        background-color: #1f2937;
        color: #ffffff;
        font-size: 0.875rem;
        font-weight: 500;
        border-radius: 0.5rem;
        text-decoration: none;
        transition: background-color 0.3s ease;
      }

      .github-button:hover {
        background-color: #374151;
      }

      body.dark .github-button {
        background-color: #374151;
      }

      body.dark .github-button:hover {
        background-color: #4b5563;
      }

      .github-button svg {
        width: 1rem;
        height: 1rem;
        margin-right: 0.5rem;
      }

      .footer-note {
        font-size: 0.75rem;
        color: #6b7280;
      }

      body.dark .footer-note {
        color: #9ca3af;
      }

      .footer-note a {
        color: #2563eb;
      }

      body.dark .footer-note a {
        color: #60a5fa;
      }

      /* Responsive adjustments */
      @media (max-width: 640px) {
        .container {
          padding: 1rem 0.5rem;
        }

        .day-selector {
          gap: 0.25rem;
        }

        .day-button {
          padding: 0.5rem 0.5rem;
          font-size: 0.75rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div id="clock" class="clock"></div>
        <button id="theme-toggle" class="theme-toggle">🌙</button>
      </div>

      <!-- Current Lecture -->
      <div class="card">
        <h2 class="card-title">Current Lecture</h2>
        <div id="current-lecture" class="current-lecture">
          <p>No current lecture</p>
        </div>
      </div>

      <!-- Day Selector -->
      <div class="day-selector" id="day-selector">
        <button class="day-button" data-day="Monday">Mon</button>
        <button class="day-button" data-day="Tuesday">Tue</button>
        <button class="day-button" data-day="Wednesday">Wed</button>
        <button class="day-button" data-day="Thursday">Thu</button>
        <button class="day-button" data-day="Friday">Fri</button>
      </div>

      <!-- Schedule -->
      <div class="card">
        <h3 class="card-title" id="schedule-title">Today's Schedule</h3>
        <div id="schedule-content">
          <p class="no-classes">Loading...</p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p style="margin-bottom: 1rem">
        Made by
        <a href="https://github.com/aryamaddel">Arya Maddel</a>
        💚
      </p>
      <div class="footer-actions">
        <a
          href="https://github.com/aryamaddel/college-time-table"
          class="github-button"
        >
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z"
              clip-rule="evenodd"
            ></path>
          </svg>
          View on GitHub
        </a>
        <p class="footer-note">
          Found an error?
          <a href="https://github.com/aryamaddel/college-time-table/pulls"
            >Create a PR</a
          >
          to change it.
        </p>
      </div>
    </footer>

    <script>
      let timetable = {};
      const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
      let currentDay = "";
      let isLoading = true;

      async function loadTimetable() {
        try {
          const response = await fetch("timetable.json");
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          timetable = await response.json();
          isLoading = false;
          return true;
        } catch (error) {
          console.error("Error loading timetable:", error);
          isLoading = false;
          return false;
        }
      }

      function getCurrentDay() {
        const day = new Date().getDay() - 1;
        return day >= 0 && day < days.length ? days[day] : days[0];
      }

      function parseTime(timeStr) {
        const [startTime, endTime] = timeStr.split("-");
        return { start: startTime, end: endTime };
      }

      function formatTime(time) {
        const [hour, minute] = time.split(":").map(Number);
        return `${hour % 12 || 12}:${minute.toString().padStart(2, "0")} ${
          hour >= 12 ? "PM" : "AM"
        }`;
      }

      function createLectureHTML(lecture) {
        const { start, end } = parseTime(lecture.time);
        const faculty = lecture.faculty || "";
        const room = lecture.room || "";

        return `
          <p class="lecture-name">${lecture.subject_name}</p>
          <p class="lecture-details">${formatTime(start)} - ${formatTime(
          end
        )}</p>
          <p class="lecture-details">Faculty: ${faculty}</p>
          ${room ? `<p class="lecture-details">Room: ${room}</p>` : ""}
          <p class="lecture-details">Type: ${lecture.type}</p>
        `;
      }

      function isBreakTime() {
        const now = new Date();
        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        const breakStart = 12 * 60 + 40; // 12:40 PM
        const breakEnd = 13 * 60 + 30; // 1:30 PM
        return currentMinutes >= breakStart && currentMinutes <= breakEnd;
      }

      function getCurrentLecture() {
        if (isLoading) return null;

        const now = new Date();
        const day = getCurrentDay();
        const currentMinutes = now.getHours() * 60 + now.getMinutes();

        return timetable[day]?.find((lecture) => {
          const { start, end } = parseTime(lecture.time);
          const [startHour, startMinute] = start.split(":").map(Number);
          const [endHour, endMinute] = end.split(":").map(Number);
          const startMinutes = startHour * 60 + startMinute;
          const endMinutes = endHour * 60 + endMinute;
          return currentMinutes >= startMinutes && currentMinutes <= endMinutes;
        });
      }

      function updateClock() {
        document.getElementById("clock").textContent =
          new Date().toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          });
      }

      function updateCurrentLecture() {
        const currentLecture = document.getElementById("current-lecture");
        const lecture = getCurrentLecture();

        if (isLoading) {
          currentLecture.className = "current-lecture";
          currentLecture.innerHTML = "<p>Loading...</p>";
          return;
        }

        if (isBreakTime()) {
          currentLecture.className = "current-lecture break";
          currentLecture.innerHTML = `
            <p class="lecture-name">Break Time</p>
            <p class="lecture-details">12:40 PM - 1:30 PM</p>
            <p class="lecture-details">Enjoy your break! 🍽️</p>
          `;
        } else if (lecture) {
          currentLecture.className = "current-lecture active";
          currentLecture.innerHTML = createLectureHTML(lecture);
        } else {
          currentLecture.className = "current-lecture";
          currentLecture.innerHTML = "<p>No current lecture</p>";
        }
      }

      function selectDay(day) {
        currentDay = day;

        document.querySelectorAll("#day-selector button").forEach((btn) => {
          btn.classList.toggle("active", btn.dataset.day === day);
        });

        displaySchedule();
      }

      function displaySchedule() {
        const schedule = timetable[currentDay];
        const scheduleTitle = document.getElementById("schedule-title");
        const scheduleContent = document.getElementById("schedule-content");

        scheduleTitle.textContent = `${currentDay}'s Schedule`;

        if (isLoading) {
          scheduleContent.innerHTML = '<p class="no-classes">Loading...</p>';
          return;
        }

        if (schedule?.length) {
          scheduleContent.innerHTML = schedule
            .map(
              (lecture) => `
              <div class="schedule-item">
                ${createLectureHTML(lecture)}
              </div>
            `
            )
            .join("");
        } else {
          scheduleContent.innerHTML =
            '<p class="no-classes">No classes today</p>';
        }
      }

      function toggleTheme() {
        document.body.classList.toggle("dark");
        const isDark = document.body.classList.contains("dark");
        document.getElementById("theme-toggle").textContent = isDark
          ? "☀️"
          : "🌙";
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }

      function loadTheme() {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
          document.body.classList.add("dark");
          document.getElementById("theme-toggle").textContent = "☀️";
        } else {
          document.body.classList.remove("dark");
          document.getElementById("theme-toggle").textContent = "🌙";
        }
      }

      document.addEventListener("DOMContentLoaded", async () => {
        loadTheme();

        document.querySelectorAll("#day-selector button").forEach((btn) => {
          btn.addEventListener("click", () => selectDay(btn.dataset.day));
        });

        document
          .getElementById("theme-toggle")
          .addEventListener("click", toggleTheme);

        await loadTimetable();
        selectDay(getCurrentDay());
        updateClock();
        updateCurrentLecture();

        setInterval(() => {
          updateClock();
          updateCurrentLecture();
        }, 1000);
      });
    </script>
  </body>
</html>
