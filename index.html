<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timetable</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f0f0;
      }
      h1 {
        text-align: center;
        color: #333;
      }
      #current-lecture {
        background-color: #fff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      #current-lecture h2 {
        margin-top: 0;
        color: #2c3e50;
      }
      #current-lecture p {
        margin: 10px 0;
        color: #34495e;
      }
      #full-timetable {
        background-color: #fff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      #full-timetable h3 {
        margin-top: 0;
        color: #2c3e50;
      }
      .lecture {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }
      .lecture:last-child {
        border-bottom: none;
      }
    </style>
  </head>
  <body>
    <div id="current-lecture"></div>
    <div id="full-timetable"></div>

    <script>
      let timetable = {};

      async function loadTimetable() {
        const days = ["monday", "tuesday", "wednesday", "thursday", "friday"];
        for (const day of days) {
          const response = await fetch(`${day}.json`);
          const data = await response.json();
          timetable[day] = data;
        }
        displayCurrentLecture();
        displayFullTimetable();
      }

      function convertTo12Hour(time) {
        const [hour, minute] = time.split(":").map(Number);
        const period = hour >= 12 ? "PM" : "AM";
        const adjustedHour = hour % 12 || 12;
        return `${adjustedHour}:${minute.toString().padStart(2, "0")} ${period}`;
      }

      function getCurrentLecture() {
        const now = new Date();
        const day = [
          "sunday",
          "monday",
          "tuesday",
          "wednesday",
          "thursday",
          "friday",
          "saturday",
        ][now.getDay()].toLowerCase();
        const currentTime = now.getHours() * 60 + now.getMinutes();

        if (timetable[day]) {
          for (const lecture of timetable[day]) {
            const [startHour, startMinute] = lecture.starttime.split(":").map(Number);
            const [endHour, endMinute] = lecture.endtime.split(":").map(Number);
            const startTime = startHour * 60 + startMinute;
            const endTime = endHour * 60 + endMinute;

            if (currentTime >= startTime && currentTime <= endTime) {
              return lecture;
            }
          }
        }
        return null;
      }

      function displayCurrentLecture() {
        const currentLectureElement = document.getElementById("current-lecture");
        const lecture = getCurrentLecture();

        if (lecture) {
          currentLectureElement.innerHTML = `
            <h2>Current Lecture</h2>
            <p><strong>Subject:</strong> ${lecture.subject}</p>
            <p><strong>Time:</strong> ${convertTo12Hour(lecture.starttime)} - ${convertTo12Hour(lecture.endtime)}</p>
            <p><strong>Room:</strong> ${lecture.room}</p>
            <p><strong>Teacher:</strong> ${lecture.teacher}</p>
          `;
        } else {
          currentLectureElement.innerHTML = "<h2>No Current Lecture</h2>";
        }
      }

      function displayFullTimetable() {
        const fullTimetableElement = document.getElementById("full-timetable");
        const now = new Date();
        const currentDay = [
          "sunday",
          "monday",
          "tuesday",
          "wednesday",
          "thursday",
          "friday",
          "saturday",
        ][(now.getDay() + 1) % 7].toLowerCase();

        let html = `<h3>Tomorrow's Timetable (${
          currentDay.charAt(0).toUpperCase() + currentDay.slice(1)
        })</h3>`;

        if (timetable[currentDay]) {
          timetable[currentDay].forEach((lecture) => {
            html += `
              <div class="lecture">
                <p><strong>${lecture.subject}</strong></p>
                <p>Time: ${convertTo12Hour(lecture.starttime)} - ${convertTo12Hour(lecture.endtime)}</p>
                <p>Room: ${lecture.room}</p>
                <p>Teacher: ${lecture.teacher}</p>
              </div>
            `;
          });
        } else {
          html += "<p>No classes scheduled for tomorrow.</p>";
        }

        fullTimetableElement.innerHTML = html;
      }

      loadTimetable();
      setInterval(displayCurrentLecture, 60000); // Update every minute
    </script>
  </body>
</html>
